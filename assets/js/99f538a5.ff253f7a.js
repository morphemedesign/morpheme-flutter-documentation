"use strict";(self.webpackChunkmorpheme_flutter_documentation=self.webpackChunkmorpheme_flutter_documentation||[]).push([[2354],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=n.createContext({}),p=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},s=function(e){var t=p(e.components);return n.createElement(d.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,d=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=p(a),c=r,k=m["".concat(d,".").concat(c)]||m[c]||u[c]||l;return a?n.createElement(k,i(i({ref:t},s),{},{components:a})):n.createElement(k,i({ref:t},s))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=c;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},5233:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={sidebar_position:12},i="Local2Dart",o={unversionedId:"morpheme_cli/generate/local2dart",id:"morpheme_cli/generate/local2dart",title:"Local2Dart",description:"This command generates a robust SQLite database layer using sqflite. It automates the creation of tables, triggers, views, and seed data based on a YAML configuration file. It also generates a type-safe Service class for performing CRUD operations.",source:"@site/docs/morpheme_cli/generate/local2dart.md",sourceDirName:"morpheme_cli/generate",slug:"/morpheme_cli/generate/local2dart",permalink:"/morpheme-flutter-documentation/docs/morpheme_cli/generate/local2dart",draft:!1,tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12},sidebar:"mySidebars",previous:{title:"Core Package",permalink:"/morpheme-flutter-documentation/docs/morpheme_cli/generate/core"},next:{title:"Remove Apps",permalink:"/morpheme-flutter-documentation/docs/morpheme_cli/generate/remove-apps"}},d={},p=[{value:"Setup",id:"setup",level:2},{value:"Directory Structure",id:"directory-structure",level:2},{value:"Configuration (<code>local2dart.yaml</code>)",id:"configuration-local2dartyaml",level:2},{value:"Global Configuration",id:"global-configuration",level:3},{value:"Table Definition",id:"table-definition",level:3},{value:"Column Properties",id:"column-properties",level:4},{value:"Foreign Key Actions",id:"foreign-key-actions",level:4},{value:"Queries (Custom Joins &amp; Aggregations)",id:"queries-custom-joins--aggregations",level:3},{value:"Views",id:"views",level:3},{value:"Seeds (Initial Data)",id:"seeds-initial-data",level:3},{value:"Triggers",id:"triggers",level:3},{value:"Generated API",id:"generated-api",level:2},{value:"Standard CRUD Operations",id:"standard-crud-operations",level:3},{value:"Usage",id:"usage",level:3},{value:"Options",id:"options",level:2},{value:"Available Options",id:"available-options",level:3}],s={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"local2dart"},"Local2Dart"),(0,r.kt)("p",null,"This command generates a robust SQLite database layer using ",(0,r.kt)("inlineCode",{parentName:"p"},"sqflite"),". It automates the creation of tables, triggers, views, and seed data based on a YAML configuration file. It also generates a type-safe Service class for performing CRUD operations."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"morpheme local2dart\n")),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"If you haven't set up ",(0,r.kt)("inlineCode",{parentName:"p"},"local2dart")," yet, initialize the configuration with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"morpheme local2dart init\n")),(0,r.kt)("p",null,"This generates the default configuration file."),(0,r.kt)("h2",{id:"directory-structure"},"Directory Structure"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 local2dart/\n\u2502   \u2514\u2500\u2500 local2dart.yaml      # Your database schema definition\n\u2514\u2500\u2500 morpheme.yaml\n")),(0,r.kt)("p",null,"The generated code will be placed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"core")," module:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"core/\n\u2514\u2500\u2500 lib/\n    \u2514\u2500\u2500 packages/\n        \u2514\u2500\u2500 local2dart/      # The generated standalone package\n            \u251c\u2500\u2500 src/\n            \u2502   \u251c\u2500\u2500 model/   # Generated Data Models\n            \u2502   \u2514\u2500\u2500 service/ # Generated Services (Repositories)\n            \u2514\u2500\u2500 local2dart.dart\n")),(0,r.kt)("h2",{id:"configuration-local2dartyaml"},"Configuration (",(0,r.kt)("inlineCode",{parentName:"h2"},"local2dart.yaml"),")"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"local2dart.yaml")," file is where you define your entire database schema."),(0,r.kt)("h3",{id:"global-configuration"},"Global Configuration"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: 1                           # Database version (increment this when changing schema)\ndir_database: "morpheme"             # The directory name for the database file\nforeign_key_constrain_support: true  # Enables Foreign Key support (PRAGMA foreign_keys = ON)\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"version"),": Integer. Must be incremented whenever you modify tables or columns to trigger migration."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"dir_database"),": String. The folder name where the ",(0,r.kt)("inlineCode",{parentName:"li"},".db")," file will be stored on the device."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"foreign_key_constrain_support"),": Boolean. If ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),", executes ",(0,r.kt)("inlineCode",{parentName:"li"},"PRAGMA foreign_keys = ON;")," on initialization, enforcing referential integrity.")),(0,r.kt)("h3",{id:"table-definition"},"Table Definition"),(0,r.kt)("p",null,"Tables are defined under the ",(0,r.kt)("inlineCode",{parentName:"p"},"table")," key. Use ",(0,r.kt)("inlineCode",{parentName:"p"},"snake_case")," for all names."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'table:\n  # Table Name\n  category:\n    create_if_not_exists: true    # Adds "IF NOT EXISTS" to create statement\n    column:\n      id:\n        type: "INTEGER"\n        constraint: "PRIMARY KEY"\n        autoincrement: true\n      name:\n        type: "TEXT"\n        nullable: false\n        default: "\'General\'"      # Default value (note nested quotes for strings)\n  \n  todo:\n    create_if_not_exists: true\n    column:\n      id:\n        type: "INTEGER"\n        constraint: "PRIMARY KEY"\n        autoincrement: true\n      title: "TEXT"               # Shorthand for simple types\n      category_id:                # Foreign key column\n        type: "INTEGER"\n        nullable: false\n    \n    # Foreign Key Definitions\n    foreign:\n      category_id:                # Column in this table\n        to_table: "category"      # Parent table\n        to_column: "id"           # Column in parent table\n        on_update: "CASCADE"      # Action on parent update\n        on_delete: "CASCADE"      # Action on parent delete\n')),(0,r.kt)("h4",{id:"column-properties"},"Column Properties"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"INTEGER"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"REAL"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"TEXT"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"BLOB"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"constraint"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"PRIMARY KEY"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"UNIQUE"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"CHECK"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"autoincrement"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (only for ",(0,r.kt)("inlineCode",{parentName:"li"},"INTEGER PRIMARY KEY"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"nullable"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," (default) or ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (adds ",(0,r.kt)("inlineCode",{parentName:"li"},"NOT NULL"),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"default"),": The default value for the column.")),(0,r.kt)("h4",{id:"foreign-key-actions"},"Foreign Key Actions"),(0,r.kt)("p",null,"Available actions for ",(0,r.kt)("inlineCode",{parentName:"p"},"on_update")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"on_delete"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NO ACTION")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"RESTRICT")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SET NULL")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SET DEFAULT")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CASCADE"))),(0,r.kt)("h3",{id:"queries-custom-joins--aggregations"},"Queries (Custom Joins & Aggregations)"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," section generates helper methods for complex custom queries, such as joins or aggregations, that don't map 1:1 to a simple table."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'query:\n  # Base Table Name\n  todo:\n    # Method Name (will generate getTodoSummary())\n    todo_summary:\n      distinct: false\n      column:\n        todo_id:\n          type: "INTEGER"\n          origin: "todo.id"           # Source column (Table.Column)\n        todo_title:\n          type: "TEXT"\n          origin: "todo.title"\n        category_name:\n          type: "TEXT"\n          origin: "category.name"\n        item_count:\n          type: "INTEGER"\n          origin: "count(*)"          # Aggregate function\n      \n      join:\n         - "INNER JOIN category ON category.id = todo.category_id"\n      \n      where: "todo.created_at BETWEEN ? AND ?"\n      group_by: "category.id"\n      order_by: "todo.id DESC"\n      limit: 10\n      offset: 0\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"origin"),": Critical for mapping the result of a generic SQL query back to a Dart field."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"where"),": Supports ",(0,r.kt)("inlineCode",{parentName:"li"},"?")," placeholders. The generated Dart method will accept arguments matching these placeholders.")),(0,r.kt)("h3",{id:"views"},"Views"),(0,r.kt)("p",null,"Views allow you to save a query definition in the database itself."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'view:\n  active_todos_view:\n    create_if_not_exists: true\n    distinct: false\n    column:\n      id:\n        type: "INTEGER"\n        origin: "id"\n      title:\n        type: "TEXT"\n        origin: "title"\n    from: todo                        # Source table\n    where: "is_completed = 0"         # Filter condition\n')),(0,r.kt)("h3",{id:"seeds-initial-data"},"Seeds (Initial Data)"),(0,r.kt)("p",null,"Pre-fill your database with data upon creation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'seed:\n  category:                           # Table to seed\n    column:\n      - "id"\n      - "name"\n    value:\n      - "1, \'Work\'"\n      - "2, \'Personal\'"\n      - "3, \'Shopping\'"\n')),(0,r.kt)("h3",{id:"triggers"},"Triggers"),(0,r.kt)("p",null,"Define raw SQL triggers to automate database actions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"trigger:\n  update_todo_timestamp:\n    raw_sql: >\n      CREATE TRIGGER IF NOT EXISTS update_todo_timestamp\n      AFTER UPDATE ON todo\n      BEGIN\n        UPDATE todo SET updated_at = CURRENT_TIMESTAMP WHERE id = OLD.id;\n      END;\n")),(0,r.kt)("h2",{id:"generated-api"},"Generated API"),(0,r.kt)("p",null,"The generated package (",(0,r.kt)("inlineCode",{parentName:"p"},"core/lib/packages/local2dart"),") provides a generic service named ",(0,r.kt)("inlineCode",{parentName:"p"},"DatabaseService")," and specific services for each table (e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"TodoService"),")."),(0,r.kt)("h3",{id:"standard-crud-operations"},"Standard CRUD Operations"),(0,r.kt)("p",null,"Each table service includes these methods:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Method"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"count()")),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the number of rows in the table.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"get()")),(0,r.kt)("td",{parentName:"tr",align:null},"Retrieves all rows as a list of Models.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"getWithPagination({limit, offset})")),(0,r.kt)("td",{parentName:"tr",align:null},"Retrieves rows with pagination limits.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"getById(id)")),(0,r.kt)("td",{parentName:"tr",align:null},"Retrieves a single row by its Primary Key.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"insert(data)")),(0,r.kt)("td",{parentName:"tr",align:null},"Inserts a new row. Returns the new ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bulkInsert(list)")),(0,r.kt)("td",{parentName:"tr",align:null},"Inserts multiple rows in a batch transaction.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"upsert(data)")),(0,r.kt)("td",{parentName:"tr",align:null},"Inserts or Updates if the key exists.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"update(data)")),(0,r.kt)("td",{parentName:"tr",align:null},"Updates a row matching the data's Primary Key.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"updateById(id, data)")),(0,r.kt)("td",{parentName:"tr",align:null},"Updates a row by a specific ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bulkUpdate(list)")),(0,r.kt)("td",{parentName:"tr",align:null},"Updates multiple rows in a batch.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"delete(data)")),(0,r.kt)("td",{parentName:"tr",align:null},"Deletes a row matching the data's Primary Key.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deleteById(id)")),(0,r.kt)("td",{parentName:"tr",align:null},"Deletes a row by its specific ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bulkDeleteById(ids)")),(0,r.kt)("td",{parentName:"tr",align:null},"Deletes multiple rows by their IDs.")))),(0,r.kt)("h3",{id:"usage"},"Usage"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Export the Library"),":\nAdd this to your ",(0,r.kt)("inlineCode",{parentName:"p"},"core/lib/core.dart"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"export 'package:local2dart/local2dart.dart';\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Use in Code"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-dart"},"// Initialize (usually in main.dart or dependency injection)\nawait DatabaseHelper.initialize();\n\n// Use a Service\nfinal service = TodoService();\n\n// Create\nfinal id = await service.insert(TodoBody(\n  title: 'Buy Milk', \n  categoryId: 1\n));\n\n// Read\nfinal todo = await service.getById(id);\nprint(todo?.title);\n")))),(0,r.kt)("h2",{id:"options"},"Options"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"morpheme local2dart [options]\n")),(0,r.kt)("p",null,"To see all available options and flags, run ",(0,r.kt)("inlineCode",{parentName:"p"},"morpheme local2dart --help"),"."),(0,r.kt)("h3",{id:"available-options"},"Available Options"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Abbr"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"--morpheme-yaml [path]")),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Path to a custom configuration file (default: ",(0,r.kt)("inlineCode",{parentName:"td"},"morpheme.yaml"),").")))))}m.isMDXComponent=!0}}]);